<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mnemosyne Quiz</title>
<style>
    body {
        font-family: Arial, sans-serif;
        padding: 20px;
    }
    #question-container {
        max-width: 500px;
        margin: 0 auto;
    }
</style>
</head>
<body>
<div id="question-container">
    <h1>Leitner Quiz</h1>
    <p id="question"></p>
    <input type="text" id="answer" placeholder="Your answer">
    <button onclick="checkAnswer()">Submit</button>
    <p id="feedback"></p>
    <p id="choices"></p>
</div>

<script>

    // html
    var html_Question = document.getElementById("question")
    var html_Choice = document.getElementById("choices")
    var html_Answer = document.getElementById("answer")
    var html_Feedback = document.getElementById("feedback")

    // variables
    var Game = {
        atNumber: 0,
        gotWrong: false,
        isGoingToNext: false,
    }
    var reviewItems_Groups = []     // the outline of this is {group: #, difficulty: #}
    var reviewItems_Choices = {}

    // Define sample quiz questions
    var reviewItems = [
        {
            id: 0,
            enumaration: false,
            question: "What is Maku's real name?",
            answer: "Mark",
            group: "Names",
            difficulty: 0,
            picture: "slot/img/"
        },
        {
            id: 1,
            enumaration: false,
            question: "What do his highschool calls him?",
            answer: "Marvin",
            group: "Names",
            difficulty: 1,
            picture: "slot/img/"
        },
        {
            id: 2,
            enumaration: false,
            question: "What do his friends used to call him nowadays?",
            answer: "Maku",
            group: "Names",
            difficulty: 2,
            picture: "slot/img/"
        },


        {
            id: 3,
            enumaration: false,
            question: "What is the color of blood?",
            answer: "Red",
            group: "Colors",
            difficulty: 0,
            picture: "slot/img/"
        },
        {
            id: 4,
            enumaration: false,
            question: "What is the color of sea?",
            answer: "Blue",
            group: "Colors",
            difficulty: 1,
            picture: "slot/img/"
        },
        {
            id: 5,
            enumaration: false,
            question: "What is the color of sun?",
            answer: "Yellow",
            group: "Colors",
            difficulty: 7,
            picture: "slot/img/"
        },
        // Add more questions as needed
    ];

    // addToGroupList first if it doesn't exists {}
    function generateGroupList(){

        // first scan the damn GrOUp you piece of sh-
        var lengthOfItems = reviewItems.length
        var tempGroupList = []
        var tempGroupListDifficulty = []


        // add the different types of group list
        for (var i in reviewItems){
            var theGroup = reviewItems[i]["group"]

            // if it doesnt exists
            if (!tempGroupList.includes(theGroup)){
                tempGroupList.push(theGroup)
            }

            // now if it exists
            var groupDifficulty = reviewItems[i]["difficulty"]
            var indexOfGroup = tempGroupList.indexOf(theGroup)

            // if it doesnt exist
            if (tempGroupListDifficulty[indexOfGroup] == null){
                console.log("AH")
                tempGroupListDifficulty[indexOfGroup] = 0
            }

            // add difficulty number
            tempGroupListDifficulty[indexOfGroup] = tempGroupListDifficulty[indexOfGroup] + groupDifficulty
        }

        
        // now finally add the temporary group to the actual group list
        for (var i in tempGroupList){
            reviewItems_Groups.push({
                group: tempGroupList[i],
                difficulty: tempGroupListDifficulty[i]
            })
        }

        console.log(reviewItems_Groups)
    }

    // generate the choices list
    function generateChoicesBasedOnGroup(Group, Item){
        if (reviewItems_Choices[Group] == null){
            reviewItems_Choices[Group] = [Item]
        } else {
            reviewItems_Choices[Group] = reviewItems_Choices[Group].concat(Item)
        }
    }

    // an algorithm that is based on the concepts of Leitner Spaced Repetition :)
    function mayonnaiseAlgorithm(){
        var temporarySFS = []; // temporarySpaceForSorting
        var temporaryFO = []; // temporaryOutput
        var itemsToBeScanned = [...reviewItems]


        // first sort the group depending on the total number of difficulty/mistake
        reviewItems_Groups.sort((a, b) => b.difficulty - a.difficulty);

        // for each group
        for (var i in reviewItems_Groups){
            var selectedGroup = reviewItems_Groups[i].group

            console.log("|| "+selectedGroup+" ||")

            // then find the matching ones in the itemsTobeScanned
            for (var j in itemsToBeScanned){

                // add them to temporarySFS and choicesBasedOnGroup
                if (itemsToBeScanned[j].group == selectedGroup){
                    
                    temporarySFS.push(itemsToBeScanned[j])
                    generateChoicesBasedOnGroup(selectedGroup, itemsToBeScanned[j].answer)                    
                }
            }


            // once the item is indeed in temporarySFS, sort them based on difficulty
            // the hardest being the first one
            temporarySFS.sort((a, b) => b.difficulty - a.difficulty);

            console.log(temporarySFS)

            // add to the final output
            temporaryFO = temporaryFO.concat(temporarySFS)

            // empty the SFS
            temporarySFS = [];


        }

        // clear the review Items then copy it to Temporary FO
        reviewItems = []
        reviewItems = temporaryFO
    }

    function showChoices(Group){
        html_Choice.innerHTML = "<br/><br/>Choices: <br/>"

        for (var i in reviewItems_Choices[Group]) {
            html_Choice.innerHTML += reviewItems_Choices[Group][i]+"<br/>"
        }
    }

    function clearFeedback(){
        console.log("Cleared")
        html_Feedback.innerHTML = ""
    }

    function displayQuestion(){
        html_Question.innerHTML = reviewItems[Game.atNumber].question + "<br/><br/> DifficultyMeter: " + reviewItems[Game.atNumber].difficulty
    }

    function reAllowToSubmit(){
        Game.isGoingToNext = false  
    }

    function proceedToNextItem(){

        if (reviewItems.length > Game.atNumber){
            html_Answer.value = ""
            html_Question.innerHTML = reviewItems[Game.atNumber].question + "<br/><br/> DifficultyMeter: " + reviewItems[Game.atNumber].difficulty
            showChoices(reviewItems[Game.atNumber].group)   
            Game.isGoingToNext = false
            Game.gotWrong = false
        } else {
            html_Question.innerHTML = "You completed the review session!, Restarting!"
            html_Choice.innerHTML = ""
            setTimeout(startReviTerm, 3000) 
        }


    }

    function checkAnswer(){
        var userAnswer = html_Answer.value.trimRight()

        if (!Game.isGoingToNext){
            // if correct
            if (reviewItems[Game.atNumber].answer == userAnswer){

                Game.isGoingToNext = true

                // decrease difficulty number

                if (Game.gotWrong == false){
                    reviewItems[Game.atNumber].difficulty -= 1
                    displayQuestion()
                }

                Game.atNumber += 1

                html_Feedback.innerHTML = "Correct! "+userAnswer+" was the correct answer!"

                setTimeout(clearFeedback, 1000);
                setTimeout(proceedToNextItem, 1000);

            // if incorrect
            } else {
                
                Game.isGoingToNext = true
                Game.gotWrong = true

                // add difficulty number
                reviewItems[Game.atNumber].difficulty += 1

                displayQuestion()
                html_Feedback.innerHTML = "Wrong Answer!"
                setTimeout(clearFeedback, 1000);
                setTimeout(reAllowToSubmit, 1000)
            }
        }



    }
    

    // start!
    function startReviTerm(){
        // reset variables
        Game.atNumber = 0
        reviewItems_Groups = []
        reviewItems_Choices = {}

        // start the functions
        generateGroupList()
        mayonnaiseAlgorithm()
        displayQuestion()
        showChoices(reviewItems[Game.atNumber].group)   

        //console.log(reviewItems)
        //console.log(reviewItems_Choices)
    }

    startReviTerm()
</script>
</body>
</html>